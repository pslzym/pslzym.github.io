<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="Ddup">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Ddup">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Ddup">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"always","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title> Ddup </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Ddup</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/07/stormfen-zu-fang-shi-he-bing-fa/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ddup">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ddup">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/07/stormfen-zu-fang-shi-he-bing-fa/" itemprop="url">
                  Storm分组方式和并发
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-07T00:16:54+08:00">
                2016-10-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##Storm分组方式和并发</p>
<ul>
<li>基础理论</li>
<li>Storm分组方式</li>
<li>Storm并发</li>
</ul>
<p>###基础理论</p>
<ul>
<li><p>Nodes(服务器):指配置在一个Storm集群中的服务器，会执行top的一部分运算。一个Storm集群可以包括一个或者多个工作node。</p>
</li>
<li><p>Worker(JVM虚拟机): 指一个node上相互独立运行的JVM进程。每一个node可以配置运行一个或者多个worker。一个top会分配到一个或者多个worker上运行。  </p>
</li>
<li><p>Executor(线程):指一个worker的JVM进程中运行的Java线程。多个task可以指派给同一个executor来执行。除非是明确指定，Storm默认会给每一个executor分配一个task。</p>
</li>
<li><p>Task(Spout/bolt实例):task是spout和bolt的实例，它们的nextTuple（）和execute（）方法会被executor线程调用执行。task代表最大并发度。executor数代表实际并发数。</p>
</li>
</ul>
<p>###Storm并发<br><img src="/uploads/2016/10/9DD2F949-EADB-41FD-BE40-CB1DBB59D2D4.png" alt=""><br>并发举例</p>
<p>Config conf = new Config();<br>//设置两个worker<br>conf.setNumWorkers(2);<br>//spout数目线程数2<br>topologyBuilder.setSpout(“blue-spout”, new BlueSpout(),2);<br>//线程数为2，并发度为4   见图<br>topologyBuilder.setBolt(“green-bolt”, new GreenBolt(), 2).setNumTasks(4).shuffleGrouping(“blue-spout”);<br>//线程数为6<br>topologyBuilder.setBolt(“yellow-bolt”, new YellowBolt(), 6).shuffleGrouping(“green-bolt”);<br>StormSubmitter.submitTopology(<br>        “mytopology”,<br>        conf,<br>    topologyBuilder.createTopology()<br>    );</p>
<p>###Storm分组方式<br>数据流分组定义了一个数据流中的tuple如何发送给top中不同bolt的task。<br>注：不是一个spout或bolt emit到多个bolt（广播方式）<br>目前官方有八种</p>
<ul>
<li><p>Shuffle Grouping(随机分组)：这种方式会随机分发tuple给bolt的各个task，每个bolt实例接收到的相同数量的tuple。</p>
</li>
<li><p>Field Grouping(按字段分组)：根据指定的字段进行分组。（重点）</p>
</li>
<li><p>Non Grouping: 无分组， 这种分组和Shuffle grouping是一样的效果，多线程下不平均分配。</p>
</li>
<li><p>All Grouping： 广播发送。The stream is replicated across all the bolt’s tasks. Use this grouping with care.</p>
</li>
<li><p>Global Grouping: 全局分组， 这个tuple被分配到storm中的一个bolt的其中一个task。再具体一点就是分配给id值最低的那个task。适合场景：想象不到。</p>
</li>
<li><p>Direct Grouping: 直接分组， 这是一种比较特别的分组方法，用这种分组意味着消息的发送者决定由消息接收者的哪个task处理这个消息。 只有被声明为Direct Stream的消息流可以声明这种分组方法。而且这种消息tuple必须使用emitDirect方法来发射。消息处理者可以通过TopologyContext来或者处理它的消息的taskid (OutputCollector.emit方法也会返回taskid)</p>
</li>
<li><p>Partial Key grouping: The stream is partitioned by the fields specified in the grouping, like the Fields grouping, but are load balanced between two downstream bolts, which provides better utilization of resources when the incoming data is skewed. This paper provides a good explanation of how it works and the advantages it provides.（最新新增）</p>
</li>
<li><p>Local or shuffle grouping: If the target bolt has one or more tasks in the same worker process, tuples will be shuffled to just those in-process tasks. Otherwise, this acts like a normal shuffle grouping.</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/05/stormshi-li-cheng-xu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ddup">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ddup">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/05/stormshi-li-cheng-xu/" itemprop="url">
                  Storm示例程序
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-05T16:04:21+08:00">
                2016-10-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##Storm示例程序</p>
<ul>
<li>测试数据</li>
<li>Spout程序</li>
<li>Bolt程序</li>
<li>主程序</li>
</ul>
<p>###测试数据<br>由于是简单的示例测试程序，我直接弄了一个代码生成了相关的数据文件。<br>最后文件数据的格式如下：<br><code><br>www.pslland.org    CYYH6Y2345GHI899OFG4V9U567    2014-01-07 11:40:49<br>www.taobao.com    XXYH6YCGFJYERTT834R52FDXV9U34    2014-01-07 08:40:50<br>www.taobao.com    CYYH6Y2345GHI899OFG4V9U567    2014-01-07 09:40:49<br>www.taobao.com    BBYH61456FGHHJ7JL89RG5VV9UYU7    2014-01-07 08:40:53<br>www.taobao.com    VVVYH6Y4V4SFXZ56JIPDPB4V678    2014-01-07 10:40:49<br>www.taobao.com    ABYH6Y4V4SCVXTG6DPB4VH9U123    2014-01-07 08:40:50<br>www.taobao.com    CYYH6Y2345GHI899OFG4V9U567    2014-01-07 11:40:49<br>www.pslland.org    XXYH6YCGFJYERTT834R52FDXV9U34    2014-01-07 08:40:52<br></code><br>行数自己控制</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">import java.io.File;</span><br><span class="line">import java.io.FileOutputStream;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.util.Random;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Created by psl on 9/24/16.</span><br><span class="line"> */</span><br><span class="line">public class genrateData &#123;</span><br><span class="line">    public static void main(String [] argv)&#123;</span><br><span class="line">        File logFile = new File(&quot;test.log&quot;);</span><br><span class="line"></span><br><span class="line">        Random random = new Random();</span><br><span class="line"></span><br><span class="line">        String [] hosts = &#123;&quot;www.pslland.org&quot;, &quot;www.taobao.com&quot;&#125;;</span><br><span class="line"></span><br><span class="line">        String [] sessions = &#123;&quot;ABYH6Y4V4SCVXTG6DPB4VH9U123&quot;, &quot;XXYH6YCGFJYERTT834R52FDXV9U34&quot;, &quot;BBYH61456FGHHJ7JL89RG5VV9UYU7&quot;,</span><br><span class="line">                &quot;CYYH6Y2345GHI899OFG4V9U567&quot;, &quot;VVVYH6Y4V4SFXZ56JIPDPB4V678&quot;&#125;;</span><br><span class="line">        String [] time = &#123;&quot;2014-01-07 08:40:50&quot;, &quot;2014-01-07 08:40:51&quot;, &quot;2014-01-07 08:40:52&quot;, &quot;2014-01-07 08:40:53&quot;,</span><br><span class="line">                &quot;2014-01-07 09:40:49&quot;, &quot;2014-01-07 10:40:49&quot;, &quot;2014-01-07 11:40:49&quot;, &quot;2014-01-07 12:40:49&quot;&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        StringBuffer stringBuffer = new StringBuffer();</span><br><span class="line"></span><br><span class="line">        for (int i = 0; i &lt; 50; i++)&#123;</span><br><span class="line">            stringBuffer.append(hosts[random.nextInt(2)] + &apos;\t&apos; + sessions[random.nextInt(5)] + &apos;\t&apos; + time[random.nextInt(8)] + &apos;\n&apos;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (!logFile.exists())&#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                logFile.createNewFile();</span><br><span class="line">            &#125;catch (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        FileOutputStream fs = null;</span><br><span class="line">        byte [] b = (stringBuffer.toString()).getBytes();</span><br><span class="line">        try &#123;</span><br><span class="line">            fs = new FileOutputStream(logFile);</span><br><span class="line">            fs.write(b);</span><br><span class="line">            fs.close();</span><br><span class="line">        &#125;catch (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>###Spout程序</p>
<p><img src="/uploads/2016/10/spout1.png" alt=""><br>类继承图</p>
<p><img src="/uploads/2016/10/spout2.png" alt=""><br>ISpout接口</p>
<p>Spout程序层抽象是ISpout接口<br>Open()是初始化方法<br>nextTuple()循环发射数据<br>ack() 成功处理tuple回调方法<br>Fail()处理失败tuple回调方法<br>activate和deactivate ：spout可以被暂时激活和关闭<br>close方法在该spout关闭前执行，<br>但是并不能得到保证其一定被执行，kill -9时不执行，<br>Storm kill {topoName} 时执行</p>
<p>原则：通常情况下（Shell和事务型的除外），实现一个Spout，可以直接实现接口IRichSpout，如果不想写多余的代码，可以直接继承BaseRichSpout。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.storm.spout.SpoutOutputCollector;</span><br><span class="line">import org.apache.storm.task.TopologyContext;</span><br><span class="line">import org.apache.storm.topology.IRichSpout;</span><br><span class="line">import org.apache.storm.topology.OutputFieldsDeclarer;</span><br><span class="line">import org.apache.storm.tuple.Fields;</span><br><span class="line">import org.apache.storm.tuple.Values;</span><br><span class="line"></span><br><span class="line">import java.io.BufferedReader;</span><br><span class="line">import java.io.FileInputStream;</span><br><span class="line">import java.io.InputStreamReader;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Created by psl on 9/24/16.</span><br><span class="line"> */</span><br><span class="line">public class mySpout implements IRichSpout&#123;</span><br><span class="line">    public void declareOutputFields(OutputFieldsDeclarer outputFieldsDeclarer) &#123;</span><br><span class="line">        outputFieldsDeclarer.declare(new Fields(&quot;LOG&quot;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Map&lt;String, Object&gt; getComponentConfiguration() &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    SpoutOutputCollector spoutOutputCollector = null;</span><br><span class="line">    FileInputStream fs = null;</span><br><span class="line">    InputStreamReader isr = null;</span><br><span class="line">    BufferedReader br;</span><br><span class="line"></span><br><span class="line">    public void open(Map map, TopologyContext topologyContext, SpoutOutputCollector spoutOutputCollector) &#123;</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            this.spoutOutputCollector = spoutOutputCollector;</span><br><span class="line">            this.fs = new FileInputStream(&quot;test.log&quot;);</span><br><span class="line">            this.isr = new InputStreamReader(fs, &quot;UTF-8&quot;);</span><br><span class="line">            this.br = new BufferedReader(isr);</span><br><span class="line"></span><br><span class="line">        &#125;catch (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void close() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            this.br.close();</span><br><span class="line">            this.isr.close();</span><br><span class="line">            this.fs.close();</span><br><span class="line">        &#125;catch (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void activate() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void deactivate() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String str = null;</span><br><span class="line">    public void nextTuple() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            while ((str = this.br.readLine()) != null)&#123;</span><br><span class="line">                spoutOutputCollector.emit(new Values(str));</span><br><span class="line">                Thread.sleep(3000);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;catch ( Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void ack(Object o) &#123;</span><br><span class="line">        System.out.println(&quot;spout ack: &quot; + o.toString());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void fail(Object o) &#123;</span><br><span class="line">        System.out.println(&quot;spout fail: &quot; + o.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>###Bolt程序</p>
<p><img src="/uploads/2016/10/bolt1.png" alt=""><br>Bolt类继承图</p>
<p><img src="/uploads/2016/10/bolt2.png" alt=""><br>IBolt方法</p>
<p>prepare方法进行初始化，<br>传入当前执行的上下文<br>execute接受一个tuple进行处理，<br>也可emit数据到下一级组件<br>cleanup 同ISpout的close方法，在关闭前调用，<br>不保证其一定执行。</p>
<p>IBolt继承了Serializable，我们在nimbus上提交了topology以后，创建出来的bolt会序列化后发送到具体执行的worker(工作进程)上去。worker在执行该Bolt时，会先调用prepare方法传入当前执行的上下文.<br>execute接受一个tuple进行处理，并用prepare方法传入的OutputCollector的ack方法（表示成功）或fail（表示失败）来反馈处理结果.还可以通过OutputCollector的emit方法把结果发射到下一级组件。</p>
<p>IBasicBolt接口，实现该接口的Bolt不用在代码中提供反馈结果了，Storm内部会自动反馈成功。如果你确实要反馈失败，可以抛出FailedException。</p>
<p>（后续章节讲到的Trident均不用显性调用ack和fail，框架会自动调。）</p>
<p>实现一个Bolt，可以实现IRichBolt接口或继承BaseRichBolt，如果不想自己处理结果反馈，可以实现 IBasicBolt接口或继承BaseBasicBolt，它实际上相当于自动做了prepare方法和 collector.emit.ack(inputTuple)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.storm.task.IBolt;</span><br><span class="line">import org.apache.storm.task.OutputCollector;</span><br><span class="line">import org.apache.storm.task.TopologyContext;</span><br><span class="line">import org.apache.storm.topology.IRichBolt;</span><br><span class="line">import org.apache.storm.topology.OutputFieldsDeclarer;</span><br><span class="line">import org.apache.storm.tuple.Fields;</span><br><span class="line">import org.apache.storm.tuple.Tuple;</span><br><span class="line"></span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Created by psl on 9/24/16.</span><br><span class="line"> */</span><br><span class="line">public class mybolt implements IRichBolt&#123;</span><br><span class="line"></span><br><span class="line">    OutputCollector outputCollector = null;</span><br><span class="line">    public void prepare(Map map, TopologyContext topologyContext, OutputCollector outputCollector) &#123;</span><br><span class="line">        this.outputCollector = outputCollector;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String valueString = null;</span><br><span class="line">    int num = 0;</span><br><span class="line">    public void execute(Tuple tuple) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            valueString = tuple.getStringByField(&quot;LOG&quot;);</span><br><span class="line">            if(valueString != null)&#123;</span><br><span class="line">                num++;</span><br><span class="line">                System.err.println(Thread.currentThread().getName() + &quot;   line : &quot; + num + &quot;   sessionId : &quot; + valueString.split(&quot;\t&quot;)[1]);</span><br><span class="line">            &#125;</span><br><span class="line">            outputCollector.ack(tuple);</span><br><span class="line">            Thread.sleep(2000);</span><br><span class="line">        &#125;catch (Exception e)&#123;</span><br><span class="line">            outputCollector.fail(tuple);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void cleanup() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void declareOutputFields(OutputFieldsDeclarer outputFieldsDeclarer) &#123;</span><br><span class="line">        outputFieldsDeclarer.declare(new Fields(&quot;&quot;));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Map&lt;String, Object&gt; getComponentConfiguration() &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>###主程序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.storm.Config;</span><br><span class="line">import org.apache.storm.LocalCluster;</span><br><span class="line">import org.apache.storm.StormSubmitter;</span><br><span class="line">import org.apache.storm.topology.TopologyBuilder;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Created by psl on 9/24/16.</span><br><span class="line"> */</span><br><span class="line">public class main &#123;</span><br><span class="line">    public static void main(String [] argv)&#123;</span><br><span class="line">        TopologyBuilder topologyBuilder = new TopologyBuilder();</span><br><span class="line"></span><br><span class="line">        topologyBuilder.setSpout(&quot;spout&quot;, new mySpout(), 1);</span><br><span class="line">        topologyBuilder.setBolt(&quot;bolt&quot;, new mybolt(), 1).shuffleGrouping(&quot;spout&quot;);</span><br><span class="line"></span><br><span class="line">        Config conf = new Config() ;</span><br><span class="line">        conf.setDebug(true);</span><br><span class="line"></span><br><span class="line">        if (argv.length &gt; 0)&#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                StormSubmitter.submitTopology(argv[0], conf, topologyBuilder.createTopology());</span><br><span class="line"></span><br><span class="line">            &#125;catch (Exception e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            LocalCluster localCluster = new LocalCluster();</span><br><span class="line">            localCluster.submitTopology(&quot;mytopology&quot;, conf, topologyBuilder.createTopology());</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/04/hbasexie-chu-li-qi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ddup">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ddup">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/04/hbasexie-chu-li-qi/" itemprop="url">
                  Hbase协处理器
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-04T18:23:00+08:00">
                2016-10-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##Hbase 协处理器<br>HBase 做为列数据库最令人诟病的特性包括：<br>无法轻易建立‘二级索引’，难以执行求和、计数、排序等操作。</p>
<p>为了减少在客服端做大量的运算，Hbase引入了coprocessor，能够轻易建立二次索引、复杂过滤器以及访问控制符等。</p>
<p>协处理器分为两种类型，系统协处理器可以全局导入region server上所有的数据表，表协处理器即是用户可以指定一张表使用协处理器。<br>协处理器为了提高灵活性，提供了两种不同的插件。一个是观察者模式（observer），类似与数据库的触发器。另一个是终端（endpoint）,动态的终端有点像存储过程。</p>
<ul>
<li>observer</li>
<li>endpoint</li>
</ul>
<p>###observer<br><img src="/uploads/2016/10/60b135e5-04c6-4197-b262-e7cd08de784b.png" alt=""><br>模型</p>
<p>以上的函数是比较老的，注意最新的代码。</p>
<p>Observer最新的类型有四种：</p>
<ul>
<li><p>RegionObserver: 提供客户端的数据操纵事件钩子:Get、Put、Delete、Scan等。</p>
</li>
<li><p>RegionServerObserver : A RegionServerObserver allows you to observe events related to the RegionServer’s operation, such as starting, stopping, or performing merges, commits, or rollbacks.  最新加的。</p>
</li>
<li><p>MasterObserver： 提供DDL-类型的操作钩子。如创建、删除、修改数据表等。 这些接口可以同时使用在同一个地方,按照不同优先级顺序执行.用户可以任意基于协处理 器实现复杂的HBase功能层。HBase有很多种事件可以触发观察者方法,这些事件与方法 从HBase0.92版本起,都会集成在HBase API中。不过这些API可能会由于各种原因有所改 动,不同版本的接口改动比较大。</p>
</li>
<li><p>WalObserver：提供WAL相关操作钩子。</p>
</li>
</ul>
<p>主要讨论RegionObserver相关代码的编写：</p>
<pre><code>public class RegionObserverTest extends BaseRegionObserver{

private static byte[] fixed_rowkey = Bytes.toBytes(&quot;0004&quot;);

@Override
public void preGetOp(ObserverContext&lt;RegionCoprocessorEnvironment&gt; e, Get get, List&lt;Cell&gt; results) throws IOException {
    if(Bytes.equals(get.getRow(), fixed_rowkey)){
        KeyValue keyValue = new KeyValue(get.getRow(), Bytes.toBytes(&quot;time&quot;), Bytes.toBytes(&quot;key_changed&quot;),
                Bytes.toBytes(&quot;value_changed&quot;));

        results.add(keyValue);

    }
}
}

在编写代码中遇到的问题：
    1.IDEA找不到BaseRegionObserver。这个是因为原先我们编写Hbase客服端程序只用到了hbase-client包，在编写coprocessor程序的时候需要导入hbase-server.
    \&lt;dependency&gt;
            \&lt;groupId&gt;org.apache.hbase\&lt;/groupId&gt;
            \&lt;artifactId&gt;hbase-server\&lt;/artifactId&gt;
            \&lt;version&gt;1.2.3\&lt;/version&gt;
  \&lt;/dependency&gt;
  2.程序正常导入表之后，scan出来的行没有变化。这个是因为此coprocessor只是针对get方法，使用get去获取某一行就OK。
</code></pre><p>如何使其正常运作。</p>
<ol>
<li>先将上述的代码打包生成一个jar文件。</li>
<li>将jar文件传入HDFS的一个相应的路径</li>
<li>disable 表 （disable ‘user_info’）</li>
<li>alter 修改表相关配置 （alter ‘user_info’, ‘coprocessor’=&gt;’hdfs:///coprocessor/hbaseRegionObserver.jar|org.pslland.RegionObserverTest||’）</li>
<li>enable相关表   （enable ‘user_info’）</li>
<li>get相关数据，检查是否生效    （get ‘user_info’, ‘0004’）</li>
</ol>
<p>###endpoint<br>endpoint常用于求和等高级功能，相关API在1.2.3里面改动比较大。相关例子参考：<br><a href="http://www.3pillarglobal.com/insights/hbase-coprocessors" target="_blank" rel="noopener">http://www.3pillarglobal.com/insights/hbase-coprocessors</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/04/hbaseguo-lu-qi-de-shi-yong/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ddup">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ddup">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/04/hbaseguo-lu-qi-de-shi-yong/" itemprop="url">
                  HBase过滤器的使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-04T10:53:27+08:00">
                2016-10-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##HBsae 过滤器</p>
<ul>
<li>过滤器API</li>
</ul>
<p>###过滤器的使用</p>
<ol>
<li>使用过滤器可以提高操作表的效率,HBase中两种数据读取函数get()和scan()都支持过滤器,支持直接访问和通过指定起止行键来访问,但是缺少细粒度的筛选功能,如基于正则表达式对行键或值进行筛选的功能。</li>
<li>可以使用预定义好的过滤器或者是实现自定义过滤器</li>
<li>过滤器在客户端创建,通过RPC传送到服务器端,在服务器端执行过滤操作,把数据返回给客户端</li>
</ol>
<p><img src="/uploads/2016/10/QQ20161004-0.png" alt=""><br>原理图</p>
<p>不使用过滤器的情况下，scan可以通过设置开始行和结束行的方式进行过滤。（其中设置的条件是左闭右开）<br>scan ‘user_info’, {STARTROW=&gt;’0001’, ENDROW=&gt;’0003’}<br>缺少细粒度的筛选功能</p>
<p>####过滤器类型和名称</p>
<ol>
<li><p>Comparision Filters(比较过滤器) (主要针对行键名和列族名进行过滤)<br> RowFilter<br> FamilyFilter<br> QualifierFilter<br> ValueFilter<br> DependentColumnFilter</p>
</li>
<li><p>Dedicated Filters(专用过滤器)  （可以针对值进行过滤）<br> SingleColumnValueFilter<br> SingleColumnValueExcludeFilter<br> PrefixFilter<br> PageFilter<br> KeyOnlyFilter<br> FirstKeyOnlyFilter<br> TimestampsFilter<br> RandomRowFilter</p>
</li>
</ol>
<p>3.Decorating Filters(附加过滤器)<br>SkipFilter<br>WhileMatchFilters</p>
<p>####过滤器的使用<br>RowFilter—&gt;BinaryComparator,RegexStringComparator</p>
<pre><code>public static void filterTest(String tableName, Connection connection){
        Scan scan = new Scan();
        scan.setCaching(1000);
        ////BinaryComparator, BinaryPrefixComparator, BitComparator, LongComparator, NullComparator, RegexStringComparator, SubstringComparator
//        RowFilter rowFilter = new RowFilter(CompareFilter.CompareOp.EQUAL, new BinaryComparator(Bytes.toBytes(&quot;0001&quot;)));
        RowFilter rowFilter = new RowFilter(CompareFilter.CompareOp.EQUAL, new RegexStringComparator(&quot;000\\w+&quot;));


    scan.setFilter(rowFilter);

    System.out.println(&quot;test-----&quot;);

    try {
        Table table = connection.getTable(TableName.valueOf(tableName));
        ResultScanner scanner = table.getScanner(scan);
        for (Result result: scanner){
            System.out.println(result);
        }

    } catch (IOException e) {
        e.printStackTrace();
    }
}
</code></pre><p>PageFilter</p>
<pre><code>public static void PagefilterTest(String tableName, Connection connection){

    //scan.setCaching(1000);

    PageFilter pageFilter = new PageFilter(3);

    byte [] lastRow = null;

    int pageCount = 0;

    try {
        while (++pageCount &gt; 0){

            System.out.println(&quot;pageCount: &quot; + pageCount);
            Scan scan = new Scan();
            scan.setFilter(pageFilter);

            if (lastRow != null){
                scan.setStartRow(lastRow);
            }

            Table table = connection.getTable(TableName.valueOf(tableName));

            ResultScanner scanner = table.getScanner(scan);

            int count = 0;
            for (Result result: scanner){
                lastRow = result.getRow();

                //避免每一页最后一个row重复
                if(++count &gt;= 3){
                    break;
                }
                System.out.println(result);
            }

            ////处理最后一页
            if(count &lt; 3){
                break;
            }

        }
    } catch (IOException e) {
        e.printStackTrace();
    }
}
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/03/hbaseji-chu-apide-shi-yong/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ddup">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ddup">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/03/hbaseji-chu-apide-shi-yong/" itemprop="url">
                  Hbase基础API的使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-03T17:35:43+08:00">
                2016-10-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##HBsae API使用</p>
<ul>
<li>基础API</li>
<li>扫描器API</li>
</ul>
<p>###基础API 与 扫描器API<br>1.创建表</p>
<pre><code>    Configuration conf = new Configuration();
    conf.set(&quot;hbase.zookeeper.quorum&quot;, &quot;192.168.0.110:2181&quot;);

    Connection conn = null;
    conn = ConnectionFactory.createConnection(conf);

    HBaseAdmin hBaseAdmin = (HBaseAdmin)conn.getAdmin();

    createTable(&quot;tableName1&quot;, &quot;tst1&quot;, &quot;tst2&quot;, hBaseAdmin);

    public static  void createTable(String tableName, String column1, String column2, HBaseAdmin hBaseAdmin)throws IOException{

    //TableName tableName = new TableName();

    HTableDescriptor tableDescriptor = new HTableDescriptor(TableName.valueOf(tableName));

    tableDescriptor.addFamily(new HColumnDescriptor(column1));

    HColumnDescriptor hColumnDescriptor = new HColumnDescriptor(column2);

    hColumnDescriptor.setVersions(3, 3);

    tableDescriptor.addFamily(hColumnDescriptor);

    hBaseAdmin.createTable(tableDescriptor);

}
</code></pre><p>2.插入数据</p>
<pre><code>   Configuration conf = new Configuration();
   conf.set(&quot;hbase.zookeeper.quorum&quot;, &quot;192.168.0.110:2181&quot;);

   //HBaseAdmin hBaseAdmin = new HBaseAdmin(conf);
   Connection conn = null;
   conn = ConnectionFactory.createConnection(conf);

    putDatas(&quot;tableName1&quot;, conn);

    public static void putDatas(String tableName, Connection connection) throws  IOException{
    //String [] rows =
    Table table = connection.getTable(TableName.valueOf(tableName));

    Put put = new Put(&quot;rowKey1_psl01&quot;.getBytes());

    put.addColumn(&quot;tst1&quot;.getBytes(), &quot;tst1_key&quot;.getBytes(), &quot;tst1_value&quot;.getBytes());

    put.addColumn(&quot;tst2&quot;.getBytes(), &quot;tst2_key&quot;.getBytes(), &quot;tst2_value&quot;.getBytes());

    table.put(put);

}    
</code></pre><p>3.获取数据</p>
<pre><code>   Configuration conf = new Configuration();
   conf.set(&quot;hbase.zookeeper.quorum&quot;, &quot;192.168.0.110:2181&quot;);

   //HBaseAdmin hBaseAdmin = new HBaseAdmin(conf);
   Connection conn = null;
   conn = ConnectionFactory.createConnection(conf);

   getData(&quot;tableName1&quot;, conn);

public  static void getData(String tableName, Connection connection) throws  IOException{
    Get get = new Get(&quot;rowKey1_psl01&quot;.getBytes());
    get.addColumn(&quot;tst1&quot;.getBytes(), &quot;tst1_key&quot;.getBytes());

    Table table = connection.getTable(TableName.valueOf(tableName));

    Result result = table.get(get);

    List&lt;Cell&gt; cells = result.listCells();

    for (Cell cell : cells){
        System.out.println(&quot;qualifier : &quot; + new String(CellUtil.cloneQualifier(cell)));
        System.out.println(&quot;value: &quot; + new String(CellUtil.cloneValue(cell)));
    }
}
</code></pre><p> 4.删除数据</p>
<pre><code>    public  static void delData(String tableName, Connection connection) throws IOException{
    //hBaseAdmin.disableTable();
    Delete delete = new Delete(&quot;rowKey1_psl01&quot;.getBytes());

    delete.addColumn(&quot;tst1&quot;.getBytes(), &quot;tst1_key&quot;.getBytes());

    Table table = connection.getTable(TableName.valueOf(tableName));
    table.delete(delete);
}
</code></pre><p>  5.扫描表</p>
<pre><code>   public static void hbaseScan(String tableName, Connection connection){
    Scan scan = new Scan();
    scan.setCaching(1000);
    try {
        Table table = connection.getTable(TableName.valueOf(tableName));
        ResultScanner scanner = table.getScanner(scan);
        for (Result result: scanner){
            System.out.println(result);
        }

    } catch (IOException e) {
        e.printStackTrace();
    }
}
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/09/27/hbasedu-shu-ju-liu-cheng/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ddup">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ddup">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/27/hbasedu-shu-ju-liu-cheng/" itemprop="url">
                  Hbase读数据流程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-09-27T23:12:50+08:00">
                2016-09-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##Hbase读数据</p>
<ul>
<li>Hbase读数据流程<br>*Hbase -ROOT- 和 .META.表结构</li>
</ul>
<p>###Hbase读数据流程<br><img src="/uploads/2016/09/hbase------.png" alt=""><br>Hbase读数据流程图</p>
<pre><code>1.从zk里面获取-ROOT-表所在regionServer的信息。
2.访问-ROOT-表所在的RegionServer，找到所要查询表的记录的二级索引。
3.根据-ROOT-表里面的记录，查询对应的.META.表的regionServer，获取表真实记录所在的regionServer信息。
4.根据在.MATE.所获取的信息，查询表所在的regionServer，并获取相应的数据。
</code></pre><p>###Hbase -ROOT- 和 .MATE.表结构</p>
<p><img src="/uploads/2016/09/root.png" alt=""><br>ROOT表结构</p>
<p><img src="/uploads/2016/09/meta.png" alt=""><br>META表结构</p>
<p>两张表的结构类似，因为都是用于定位表的位置。仔细看看两张表的ROWKEY的定义，对表的位置定位基本上就清楚啦。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/09/25/hbasecun-chu-yuan-li-he-ji-chu-ming-ling/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ddup">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ddup">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/25/hbasecun-chu-yuan-li-he-ji-chu-ming-ling/" itemprop="url">
                  Hbase存储原理和基础命令
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-09-25T01:48:27+08:00">
                2016-09-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##Hbase原理和基础命令</p>
<ul>
<li>Hbase存储基本原理</li>
<li>Client端基础命令</li>
</ul>
<p>###Hbase存储基本原理</p>
<p><img src="/uploads/2016/09/Hbase1.png" alt=""><br>存储原理图</p>
<p><img src="/uploads/2016/09/Hbase2-1.png" alt=""><br>大表存储图</p>
<p>数据管理机制<br>1、hbase中的表很大—bigtable，都是分布式存储在集群的各个regionserver上</p>
<p>2、分布式存储时，需要对表进行切分，首先是按行切分成若干个hregion</p>
<p>3、表的每一个hregion都会被一个regionserver所管理</p>
<p>4、每一个hregion随着插入数据的增多，一旦达到一个阈值，会被regionserver分裂成两个</p>
<p>5、在一个hregion内部还会被按照列族切分成若干个store单元</p>
<p>6、每一个store又会被切分成若干个store file(HFile)存储到hdfs文件系统中</p>
<p>7、每一个store对象中会维护一个内存缓存 memstore，用户查询数据时首先会去memstore中进行命中</p>
<p>8、客户端往表中插入数据，首先会在hlog日志中进行记录，然后定期进行flush合并</p>
<p>###Client端基础语法</p>
<p><img src="/uploads/2016/09/Hbase3.png" alt=""></p>
<p><img src="/uploads/2016/09/Hbase4.png" alt=""><br>Hbase基础表结构</p>
<p>1.创建表的基础命令<br>    create ‘user_info’, ‘base_info’, ‘extra_info’;<br>    指定版本号：<br>    create ‘user_info’, {NAME =&gt;’base_info’, VERSION =&gt; 3}, ‘extra_info’</p>
<p>2.插入数据<br>    put ‘user_info’, ‘0001’, ‘base_info:phone’, ‘13967109402’<br>    put ‘user_info’, ‘0001’, ‘base_info:name’, ‘angleababy’</p>
<p>3.全表扫描<br>    scan ‘user_info’ </p>
<p>4.查看数据<br>    get ‘user_info’,’0001’, ‘base_info:name’, ‘base_info:age’<br>    get ‘user_info2’, ‘0001’, { COLUMN =&gt; ‘base_info:name’, VERSIONS =&gt; 4}   查看多个版本的数据</p>
<p>5.查看表的名称：<br>list</p>
<p>6.Hbase中数据库的概念，namespaces</p>
<pre><code>创建一个命名空间my_ns
create_namespace &apos;my_ns&apos;
在命名空间my_ns里创建my_table
create &apos;my_ns:my_table&apos;, &apos;fam&apos;
drop namespace
drop_namespace &apos;my_ns&apos;

alter namespace
alter_namespace &apos;my_ns&apos;, {METHOD =&gt; &apos;set&apos;, &apos;PROPERTY_NAME&apos; =&gt; &apos;PROPERTY_VALUE&apos;}
默认的namespace：
   default:一般没有定义名称空间的表都在default里面。
   hbase:里面存放的是Hbase的基础表（root,meta,namespace）
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/09/24/stormji-chu-yuan-li/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ddup">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ddup">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/24/stormji-chu-yuan-li/" itemprop="url">
                  Storm基础原理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-09-24T18:51:54+08:00">
                2016-09-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##Storm原理图</p>
<ul>
<li>主架构</li>
<li>主流程</li>
</ul>
<p>###主架构</p>
<pre><code>          主节点     工作节点          作业
Storm     Nimbus     supervisor      topologies,死循环
hadoop    Jobtracker  Tasktracker     MapReduce Job，执行完自动结束
</code></pre><p><img src="/uploads/2016/09/strom1.png" alt=""><br>主要架构图</p>
<p>Nimbus 和supervisor之间所有的协调工作时通过一个zookeeper集群。<br>Nimbus 进程和supervisor进程是无法直接连接和无状态的；所有的状态维持在zookeeper中或保持在本地磁盘上</p>
<p>Nimbus 负责在集群分发代码，top只能在Nimbus机器上面提交，将任务分配给其他机器。<br>Supervisor监听分配给它的节点，根据Nimbus的委派在必要时启动和关闭工作进程。每个工作进程执行top的一个子集。一个运行中的top由很多运行在很多机器上的工作进程组成。<br>在Storm中有对于流stream的抽象。流是一个不间断的无界的连续的tuple，注意Storm在建模事件流时，把流中德事件抽象为tuple即元组</p>
<p><img src="/uploads/2016/09/strom2.png" alt=""><br>工作图</p>
<p>###主流程<br>Storm认为每个stream都有一个源，也就是原始元组的源头，叫做Spout（管口）<br>处理stream内的tuple，抽象为Bolt，bolt可以消费任意数量的输入流，只要将流方向导向该bolt，同时它也可以发送新的流给其他bolt使用，这样一来，只要打开特定的spout再将spout中流出的tuple导向特定的bolt，又bolt对导入的流做处理后再导向其他bolt或者目的地。</p>
<p>可以认为spout就是水龙头，并且每个水龙头里流出的水是不同的，我们想拿到哪种水就拧开哪个水龙头，然后使用管道将水龙头的水导向到一个水处理器（bolt），水处理器处理后再使用管道导向另一个处理器或者存入容器中。</p>
<p><img src="/uploads/2016/09/strom3.png" alt=""><br>spout和bolt工作图</p>
<p>这是一张有向无环图，Storm将这个图抽象为Topology(拓扑)，Topo就是storm的Job抽象概念，一个拓扑就是一个流转换图</p>
<p>图中每个节点是一个spout或者bolt，每个spout或者bolt发送元组到下一级组件，广播方式。</p>
<p>而Spout到单个Bolt有6种grouping方式，后续细讲。</p>
<p>Storm将流中元素抽象为tuple，一个tuple就是一个值列表value list，list中的每个value都有一个name，并且该value可以是任意可序列化的类型。拓扑的每个节点都要说明它所发射出的元组的字段的name，其他节点只需要订阅该name就可以接收处理。</p>
<p><img src="/uploads/2016/09/strom4.png" alt=""></p>
<p>Streams：消息流<br>消息流是一个没有边界的tuple序列，而这些tuples会被以一种分布式的方式并行创建和处理。 每个tuple可以包含多列，字段类型可以是： integer, long, short, byte, string, double, float, boolean和byte array。 你还可以自定义类型 — 只要你实现对应的序列化器。</p>
<p>Spouts：消息源<br>Spouts是topology消息生产者。Spout从一个外部源(消息队列)读取数据向topology发出tuple。 消息源Spouts可以是可靠的也可以是不可靠的。一个可靠的消息源可以重新发射一个处理失败的tuple， 一个不可靠的消息源Spouts不会。</p>
<p>Spout类的方法nextTuple不断发射tuple到topology，storm在检测到一个tuple被整个topology成功处理的时候调用ack, 否则调用fail。<br>storm只对可靠的spout调用ack和fail。</p>
<p>Bolts：消息处理者<br>消息处理逻辑被封装在bolts里面，Bolts可以做很多事情： 过滤， 聚合， 查询数据库等。<br>Bolts可以简单的做消息流的传递。复杂的消息流处理往往需要很多步骤， 从而也就需要经过很多Bolts。第一级Bolt的输出可以作为下一级Bolt的输入。而Spout不能有一级。</p>
<p>Bolts的主要方法是execute（死循环）连续处理传入的tuple，成功处理完每一个tuple调用OutputCollector的ack方法，以通知storm这个tuple被处理完成了。当处理失败时，可以调fail方法通知Spout端可以重新发送该tuple。</p>
<p>流程是： Bolts处理一个输入tuple, 然后调用ack通知storm自己已经处理过这个tuple了。storm提供了一个IBasicBolt会自动调用ack。<br>Bolts使用OutputCollector来发射tuple到下一级Blot。
</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/09/24/hbaseji-qun-da-jian/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ddup">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ddup">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/24/hbaseji-qun-da-jian/" itemprop="url">
                  Hbase集群搭建
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-09-24T16:40:24+08:00">
                2016-09-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##Hbase环境搭建</p>
<ul>
<li>搭建zookeeper集群和HDFS集群</li>
<li>安装Hbase软件</li>
<li>启动集群</li>
<li>shell客户端连接</li>
</ul>
<p>###搭建zookeeper集群和HDFS集群<br>zookeeper 对于Hbase集群是必不可少的。zookeeper为hadoop集群提供协同服务。<br>HDFS为Hbase提供体层的存储服务<br>zookeeper和HDFS搭建参考相关博文</p>
<p>###安装Hbase软件<br>目前Hbase最新稳定版本为1.2.3。在官网相关网页下载相关软件包。</p>
<p>1.将软件包解压到相关路径</p>
<ol>
<li>进入配置文件目录，修改相关配置文件</li>
</ol>
<pre><code>hbase-site.xml
&lt;configuration&gt;
&lt;property&gt;
            &lt;name&gt;hbase.rootdir&lt;/name&gt;
            &lt;value&gt;hdfs://Master:9000/hbase&lt;/value&gt;
    &lt;/property&gt;
    &lt;!-- 指定hbase是分布式的 --&gt;
    &lt;property&gt;
            &lt;name&gt;hbase.cluster.distributed&lt;/name&gt;
            &lt;value&gt;true&lt;/value&gt;
    &lt;/property&gt;
    &lt;!-- 指定zk的地址，多个用“,”分割 --&gt;
    &lt;property&gt;
            &lt;name&gt;hbase.zookeeper.quorum&lt;/name&gt;
            &lt;value&gt;Master:2181,Slave1:2181,Slave2:2181&lt;/value&gt;
    &lt;/property&gt;
</code></pre><p></p>
<pre><code>hbase-env.sh
export JAVA_HOME=/usr/lib/jvm/java-7-openjdk-amd64
export HBASE_OPTS=&quot;-XX:+UseConcMarkSweepGC&quot;
export HBASE_MASTER_OPTS=&quot;$HBASE_MASTER_OPTS -XX:PermSize=128m -XX:MaxPermSize=128m&quot;
export HBASE_REGIONSERVER_OPTS=&quot;$HBASE_REGIONSERVER_OPTS -XX:PermSize=128m -XX:MaxPermSize=128m&quot;
export HBASE_MANAGES_ZK=false

regionservers
Slave1
Slave2
Slave3
Slave4

以上三个文件主要配置zookeeper和HDFS相关配置信息
</code></pre><p>###启动集群<br>1.启动集群<br>进入软件包的bin目录，执行start-hbase.sh便可以启动Hbase集群。</p>
<p>2.web界面访问<a href="http://master:16010/master-status可以看到集群的状态" target="_blank" rel="noopener">http://master:16010/master-status可以看到集群的状态</a></p>
<p>3.在HMaster上面有HMaster进程，在HRegion上面有一个HReginServer的进程。<br>4.启动HMaster的backup进程。<br>在其他机器上进入bin目录启动./hbase_daemon.sh start master</p>
<p>###shell客户端连接<br>进入软件包的bin目录，运行./hbase shell即可进入Hbase的shell client端。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/09/24/stormji-qun-da-jian/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ddup">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ddup">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/24/stormji-qun-da-jian/" itemprop="url">
                  Storm集群搭建
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-09-24T16:19:57+08:00">
                2016-09-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##storm 集群搭建</p>
<ul>
<li>zookeeper环境</li>
<li>Storm配置</li>
<li>Storm运行</li>
</ul>
<p>###zookeeper环境<br>zookeeper环境搭建参考zookeeper搭建相关博文</p>
<p>###Storm配置</p>
<pre><code>1.    下载软件包
    1. 在博主学习的时候，最新的storm版本是1.02。相关下载链接：http://storm.apache.org/releases/1.0.2/index.html
    2. 解压到相关目录
        tar -zxvf apache-storm-1.0.2.tar.gz
        博主比较懒，直接解压在hadoop的主目录中。/home/hadoop/storm/apache-storm-1.0.2
    3.配置相关文件
       storm最主要的配置文件是：/home/hadoop/storm/apache-storm-1.0.2/conf/storm.yaml
    相关配置如下：
    # Licensed to the Apache Software Foundation (ASF) under one

 storm.zookeeper.servers:
     - &quot;master&quot;
     - &quot;slave1&quot;
     - &quot;slave2&quot;
 nimbus.host: &quot;master&quot;   nimbus的主机ip或者名称

 nimbus.seeds: [&quot;master&quot;, &quot;slave1&quot;, &quot;slave2&quot;, &quot;slave3&quot;, &quot;slave4&quot;]  所有机器列表

 storm.local.dir: &quot;/home/hadoop/storm/apache-storm-1.0.2/data&quot; storm文件存放目录，需要提前建立好，并赋予相关权限

 supervisor.slots.ports:    相关slots端口号
  - 6700
  - 6701
  - 6702
  - 6703

 ui.port: 8081  ui界面的端口号

 注意每一个配置项开头必须留一个空格
</code></pre><p>###Storm 运行</p>
<ul>
<li>检测nimbus节点是否能正常运行</li>
<li>拷贝相关文件，启动整个集群</li>
</ul>
<p>####检测nimbus节点是否能正常运行<br>     1.进入storm的bin目录。<br>     2.运行./storm nimbus,如果能正常输出相关命令，说明相关软件环境已经配置完成。<br>     3.ctr + c 杀掉刚刚启动的进程</p>
<p>####拷贝相关文件，启动整个集群<br>    1.拷贝storm软件的文件夹到集群中的每一台机器。<br>    2.逐个启动相关软件：<br>     nimbus ： nohup ./storm nimbus &amp;<br>     supervisor : nohup ./storm supervisor &amp;<br>    3.检查集群启动状态：<br>        运行nohup ./storm ui &amp;<br>    访问网址：master:8081查看相关集群的运行状态。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.jpeg"
               alt="ddup" />
          <p class="site-author-name" itemprop="name">ddup</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">32</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="mailto:ddupsl@163.com" target="_blank" title="Email">
                  
                    <i class="fa fa-fw fa-envelope"></i>
                  
                  Email
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://github.com/pslzym" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ddup</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="local-search-pop-overlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

  


  

</body>
</html>
